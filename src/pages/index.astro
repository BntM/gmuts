---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import CardGrid from '../components/CardGrid.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';
import home from '../data/home.json';

const showPosts = home.postsSection?.show !== false;
const posts = showPosts
  ? (await getCollection('posts'))
      .filter(post => !post.data.draft)
      .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
      .slice(0, 3)
  : [];
---

<BaseLayout title="GMUTS - Home">
  <Hero
    title={home.hero.title}
    subtitle={home.hero.subtitle}
    ctaText={home.hero.ctaText}
    ctaLink={home.hero.ctaLink}
  />

  {showPosts && (
    <section class="latest-posts">
      <div class="section-header">
        <h2>{home.postsSection.title}</h2>
        <a href="/blog">{home.postsSection.linkText}</a>
      </div>
      <CardGrid columns={3}>
        {posts.map(post => (
          <Card
            title={post.data.title}
            description={post.data.description}
            href={`/blog/${post.id}`}
            image={post.data.image}
            date={post.data.date}
          />
        ))}
      </CardGrid>
    </section>
  )}
</BaseLayout>

<style>
  .latest-posts {
    padding: 4rem 0;
  }

  .section-header {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .section-header h2 {
    margin: 0;
    font-size: 2rem;
  }

  .section-header a {
    color: #17532E;
    text-decoration: none;
  }

  .section-header a:hover {
    text-decoration: underline;
  }
</style>
